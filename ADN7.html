<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADN Binario con ADN Ajustado</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #2d004b;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 110vh;
            font-family: monospace;
        }
        canvas {
            display: block;
            max-width: 100%;
            max-height: calc(100vh - 60px);
        }
        .controls {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            border: 2px solid #fff;
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
        }
        button:hover {
            background: #fff;
            color: #2d004b;
        }
        .speed-control {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            background: #1a1a1a;
            border: 2px solid #fff;
            position: absolute;
            bottom: 60px;
        }
        .speed-control input {
            width: 150px;
            accent-color: #fff;
        }
        .speed-control label {
            color: #fff;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <button onclick="setState('scatter')">Dispersar</button>
        <button onclick="setState('adn')">ADN</button>
        <button onclick="toggleSpeedControl()">Velocidad</button>
        <div class="speed-control" id="speedControl">
            <label for="rotationSpeed">Velocidad de Rotaci√≥n: <span id="speedValue">0.004</span></label>
            <input type="range" id="rotationSpeed" min="0" max="0.05" step="0.001" value="0.004">
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const speedControl = document.getElementById('speedControl');
        const rotationSpeedInput = document.getElementById('rotationSpeed');
        const speedValue = document.getElementById('speedValue');

        function resizeCanvas() {
            canvas.width = Math.min(window.innerWidth, window.innerHeight - 60);
            canvas.height = Math.min(window.innerHeight - 60, window.innerWidth);
        }
        resizeCanvas();

        class BinaryParticle {
            constructor(x, y, char) {
                this.x = x;
                this.y = y;
                this.char = char;
                this.targetX = x;
                this.targetY = y;
                this.speed = 0.02 + Math.random() * 0.03;
                this.angle = 0;
                this.randomOffset = Math.random() * 0.1;
            }

            update(t, rotationSpeed) {
                const dx = (this.targetX - this.x) * this.speed;
                const dy = (this.targetY - this.y) * this.speed;
                this.x += dx + (Math.random() - 0.5) * this.randomOffset;
                this.y += dy + (Math.random() - 0.5) * this.randomOffset;
                this.angle = t * rotationSpeed;
            }

            draw(isADN = false, isSeven = false, adnChar = null) {
                const depth = (this.y - canvas.height / 2) / (canvas.height / 2);
                const scale = isADN ? 2 : 1 - depth * 0.3;
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(scale, scale);
                ctx.fillStyle = isSeven ? '#b8860b' : '#fff';
                ctx.font = `${20 * scale}px monospace`;
                ctx.fillText(isADN ? adnChar : this.char, 0, 0);
                ctx.restore();
            }
        }

        const particles = [];
        const numParticles = 300;
        let radius = canvas.width * 0.2;
        let helixHeight = canvas.height * 0.6;
        const turns = 4;
        const phaseShift = Math.PI;

        const adnParticles = 4;
        const adnPositions = [
            {x: -90, y: 20, char: 'A'},
            {x: -30, y: 20, char: 'D'},
            {x: 30, y: 20, char: 'N'},
            {x: 90, y: 20, char: '7'}
        ];

        for (let i = 0; i < numParticles; i++) {
            const x = Math.random() * canvas.width * 1.5 - canvas.width * 0.25;
            const y = Math.random() * canvas.height * 1.5 - canvas.height * 0.25;
            const char = Math.random() > 0.5 ? '1' : '0';
            particles.push(new BinaryParticle(x, y, char));
        }

        let time = 0;
        let state = 'scatter';
        let transitionStart = 0;
        let rotationSpeed = 0.004;
        const transitionDuration = 3000;

        function setDNAPositions(t) {
            const progress = Math.min(t / transitionDuration, 1);
            for (let i = 0; i < numParticles; i++) {
                const t = (i / numParticles) * turns * 2 * Math.PI;
                const strand = i % 2;
                const offset = strand * phaseShift;
                const targetX = canvas.width / 2 + radius * Math.cos(t + time * rotationSpeed + offset);
                const targetY = canvas.height / 2 + (i / numParticles - 0.5) * helixHeight;
                particles[i].targetX = particles[i].x + (targetX - particles[i].x) * progress;
                particles[i].targetY = particles[i].y + (targetY - particles[i].y) * progress;
            }
        }

        function setScatterPositions() {
            for (let particle of particles) {
                particle.targetX = Math.random() * canvas.width * 1.5 - canvas.width * 0.25;
                particle.targetY = Math.random() * canvas.height * 1.5 - canvas.height * 0.25;
            }
        }

        function setADNPositions(t) {
            const progress = Math.min(t / transitionDuration, 1);
            for (let i = 0; i < numParticles; i++) {
                if (i < adnParticles) {
                    const pos = adnPositions[i];
                    const targetX = canvas.width / 2 + pos.x * 1.2;
                    const targetY = canvas.height / 2 - helixHeight / 2 - 80 + pos.y * 1.2;
                    particles[i].targetX = particles[i].x + (targetX - particles[i].x) * progress;
                    particles[i].targetY = particles[i].y + (targetY - particles[i].y) * progress;
                } else {
                    const t = ((i - adnParticles) / (numParticles - adnParticles)) * turns * 2 * Math.PI;
                    const strand = i % 2;
                    const offset = strand * phaseShift;
                    const targetX = canvas.width / 2 + radius * Math.cos(t + time * rotationSpeed + offset);
                    const targetY = canvas.height / 2 + (i / numParticles - 0.5) * helixHeight;
                    particles[i].targetX = particles[i].x + (targetX - particles[i].x) * progress;
                    particles[i].targetY = particles[i].y + (targetY - particles[i].y) * progress;
                }
            }
        }

        function setState(newState) {
            if (state !== newState) {
                state = newState;
                transitionStart = time;
            }
        }

        function toggleSpeedControl() {
            speedControl.style.display = speedControl.style.display === 'flex' ? 'none' : 'flex';
        }

        rotationSpeedInput.addEventListener('input', () => {
            rotationSpeed = parseFloat(rotationSpeedInput.value);
            speedValue.textContent = rotationSpeed.toFixed(3);
        });

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            time += 16.67;

            if (state === 'scatter') {
                const progress = Math.min((time - transitionStart) / transitionDuration, 1);
                setScatterPositions();
                for (let particle of particles) {
                    particle.update(time, rotationSpeed);
                    particle.draw();
                }
            } else if (state === 'adn') {
                setADNPositions(time - transitionStart);
                for (let i = 0; i < numParticles; i++) {
                    const isADN = i < adnParticles;
                    const isSeven = isADN && i === 3;
                    const adnChar = isADN ? adnPositions[i].char : null;
                    particles[i].update(time, rotationSpeed);
                    particles[i].draw(isADN, isSeven, adnChar);
                }
            }

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            radius = canvas.width * 0.1;
            helixHeight = canvas.height * 0.8;
        });

        animate();
    </script>
</body>
</html>