---
title: 'Write replicable papers using the R package "Knitr"'
date: 2013-01-11
permalink: /posts/knitr/
tags:

---




In this section I will describe *my* take on literate programming: not the best, not the only one. Just the one I use.

The main idea is to outource your R code into LaTeX automatically. For example, this way you do not have to copy and paste standard errors, or figures. It will be automatically generated in your PDF file after compiling the .rnw

* Text processor and necessary dependencies: First you will need a software to handle code and syntax highlighting. I use [Sublime Text 3](http://www.sublimetext.com/3). Have Sublime Text 3 [installed](http://www.sublimetext.com/3).

* Inside Sublime Text:
    * Install [Package Control](https://packagecontrol.io/installation).
    * `shift+cmd+p`, then **Install Packages**, and install:
        * [R-Box](https://github.com/randy3k/R-Box).
        * [Sublime Knitr](https://github.com/andrewheiss/SublimeKnitr).
        * [SendCode](https://github.com/randy3k/SendREPL)
        * [LaTexing](http://www.latexing.com/installation.html) or [LaTeX Tools](https://github.com/SublimeText/LaTeXTools).


* In **R** you have to install **knitr**:

```r
install.packages(c("knitr", "formatR", "pacman"), repos = "http://cran.rstudio.com")
```

* In Sublime Text 3, modify **user** settings **in LaTeXing**. First line adds *knitr* capabilities, while the second line allows *BibTeX* compilation.

```tex
{"knitr": true, /* activates knitr function */
"quick_build": [ /* activates latexing capabilities? Not sure. */
    {
        "name": "Primary Quick Build: latexmk",
        "primary": true,
        "cmds": ["latexmk"]
    }
                ],
    "keep_focus": true, /* activates skim sync and pop up function */
    "keep_focus_delay": 0.1, /* reduces skim sync time */
    "pdf_viewer_osx": { /* makes sure skim is the default app. User should make sure that the NAME OF the app is correct too (it might change with some updates) */
        "skim": [
            "/Applications/Skim.app"
        ],
        "preview": [
            "/Applications/Preview.app"
        ]
    }

}
```

* Writing **R** and **LaTeX** code together:

Create a `.rnw` file. Here is a small example I modified from [Yihui Xie](https://github.com/yihui/knitr-examples/blob/master/002-minimal.Rnw), the developer of **knitr**.

Example: Lets try an example. See the output below.

---

Here is a code chunk.

```r
<<label, fig.cap='Your Title Goes Here', tidy=TRUE>>=
# Speaking of reproducibility, don't forget to set a seed so others can generate the SAME sequence!
set.seed(602)
library(MASS) # to generate multi-var distribution
e <-  as.numeric(mvrnorm(n = 100, mu = 0, Sigma = 1))
plot(e)
@
```

<img src="/resources/label-1.png" alt="Example Plot 1" style="width:400px;height:400px;">

The function `tidy=TRUE` keeps your code within the page margins. See how the line *Speaking of reproducibility...* behaves.

This code can either go in the .rnw file itself, or in your R script. I prefer the latter because sometimes my code is too lengthy and will just distract me while writing a paper, for example. 

If you decide to put your code in your R script, you need to:

1) In your .rnw file, just generate an environment that includes a tag that's shared with the R file, like so:

```r
<<chunk:example, echo = FALSE, cache = FALSE>>=

@ 
```

In this example, the tag is 'chunk:example'. 

2) In your R script, have another environment where you actually host the code, like so:

```r
## ---- chunk:example
set.seed(602)
library(MASS) # to generate multi-var distribution
e <-  as.numeric(mvrnorm(n = 100, mu = 0, Sigma = 1))
plot(e)
##
```

Thus, every time you compile your .rnw file, R will execute the 'chunk:example' chunk, and insert whatever is there (a table, a plot, a number, etc.).

Editors and (**most**) readers are **not** interested in your coding. That's fine. The important thing is to make your code available to the audience that needs it. You can hide it by calling the `echo = FALSE` function in the preamble, i.e. within the `<<>>=` symbols. Below, you will only see the plot, not the coding that generated it.


* Downloadable examples: [rnw file](https://github.com/hbahamonde/hbahamonde.github.io/blob/master/resources/literate_prog_ex.r) and [r file](https://github.com/hbahamonde/hbahamonde.github.io/blob/master/resources/literate_prog_ex.Rnw).
